<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head th:replace="fragments/general :: baseHeader(~{:: title})">
    <title th:text="${task.taskName}"></title>
</head>
<body>

<div th:replace="fragments/general :: header"></div>
<div class="container-fluid">
    <div class="page-header">
        <div class="row">
            <div class="col-2"></div>
            <div class="col-9">
            </div>
        </div>
    </div>

    <!--    POTENTIAL VERTICAL NAV BAR -->
    <div class="row">
        <div class="col-2"></div>

            <!--    TASK FORM CONTENT START-->
        <div class="col-8 card w-100 card">
        <div class="card-body">
            <div class="row">
            <p class="display-4" th:text="${task.taskName}" style="display: inline"></p>
            <form method="get"  th:action="@{/task/delete}" class="form-inline"  >
                <label class="mx-1 ml-2"  >
                    <input class="text-right mb-1" id="delete-task" type="image" height="20" width="20" src="/static/images/removeMember.svg" alt="delete"/>
                </label>
            </form>
                <span class="form-inline">
                    <label class="">
                        <input class="text-right mb-1 align-items-center" id="edit-task" type="image" height="20" width="20"
                               src="/static/images/pencil.svg" alt="edit" data-toggle="modal" data-target="#exampleModalCenter"/>
                    </label>
                    </span>

                <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Editing task</h5>
                            </div>
                            <div class="modal-body">
                                <form method="post" th:action="@{/task/edit}" th:object="${task}">
                                    <div class="form-group">
                                        <label for="taskName">Task name</label>
                                        <input name="taskName" id="taskName" type="text" class="form-control"
                                               th:field="*{taskName}" th:required="required" placeholder="Task name">
                                    </div>
                                    <div class="form-group">
                                        <label for="taskDescription">Task description</label>
                                        <textarea name="taskDescription" id="taskDescription" type ="text" class="form-control"  th:required="required"
                                                  th:field="*{taskDescription}" placeholder="Task description"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="dueDate">Due date</label>
                                        <input name="dueDate" id="dueDate" type="date" class="form-control"
                                               th:field="*{dueDate}">
                                    </div>
                                    <div class="form-group">
                                        <label for="duration">Duration in minutes</label>
                                        <input name="duration" id="duration" type="number" class="form-control"
                                               th:field="*{duration}">
                                    </div>
                                    <div class="form-group">
                                        <input name="claimedUserName" id="claimedUserName" type="hidden" class="form-control"
                                               th:field="*{claimedUserName}">
                                        <input name="taskId" id="taskId" type="hidden" class="form-control"
                                               th:field="*{taskId}">
                                        <input name="taskDone" id="taskDone" type="hidden" class="form-control"
                                               th:field="*{taskDone}">
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary text-left float-left" data-dismiss="modal">Close</button>
                                        <input type="submit" class="btn btn-primary text-right" value="Save">
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <p th:text="${task.taskDescription}"></p>
            <!--       Claim button if unclaimed-->
            <div th:if="${task.claimedUserName == null}" class="">
                <form th:action="@{/task/detail/claim}" method="post" class="" >
                    <div class="text-right float-right" style="display:inline;">
                        <button type="submit" class="btn btn-primary text-right">Claim</button>
                    </div>
                    <span>
                        <input class="list-group-item-check pe-none"  checked type="hidden" th:name="taskId" th:value="${task.taskId}">
                    </span>
                </form>
            </div>
            <!--      Done button if claimed & owned-->
            <div th:if="${task.claimedUserName == currentUser}" class="">
                <form th:action="@{/task/detail/done}" method="post" th:object="${task}">
                    <span>
                        <input class="list-group-item-check pe-none"  checked type="hidden" th:name="taskId" th:value="${task.taskId}">
                    </span>
                    <div class="text-right float-right" style="display:inline;">
                        <button type="submit" class="btn btn-primary text-right">Done</button>
                    </div>
                </form>
            </div>
            <!--       Unclaim button if claimed & owned-->
            <div th:if="${(task.claimedUserName == currentUser) && !(task.isTaskDone())}" class="">
                <form th:action="@{/task/detail/unclaim}" method="post" class="" >
                    <div class="text-right float-right" style="display:inline;">
                        <button type="submit" class="btn btn-primary text-right mr-2">Unclaim</button>
                    </div>
                    <span>
                        <input class="list-group-item-check pe-none"  checked type="hidden" th:name="taskId" th:value="${task.taskId}">
                    </span>
                </form>
            </div>




            <!--                                                Displays duration, if available-->
            <span th:if="${task.duration > 0}" class="text-left" style="display:inline;">
                <img th:if="${task.duration < 59}" src="/static/images/clock-history.svg" th:text="' '+${task.duration}+'  minutes'" class="" alt="duration">
                <img th:if="${(task.duration < 120) && (task.duration > 59)}" src="/static/images/clock-history.svg" th:text="' '+${(task.duration/60)-(1 - (task.duration/60))}+'+ hour'" class="" alt="duration">
                <img th:if="${(task.duration < 180) && (task.duration > 119)}" src="/static/images/clock-history.svg" th:text="' '+${(task.duration/60)-(2 - (task.duration/60))}+'+ hours'" class="" alt="duration">
                <img th:if="${(task.duration < 240) && (task.duration > 179)}" src="/static/images/clock-history.svg" th:text="' '+${(task.duration/60)-(3 - (task.duration/60))}+'+ hours'" class="" alt="duration">
                <img th:if="${(task.duration < 300) && (task.duration > 239)}" src="/static/images/clock-history.svg" th:text="' '+${(task.duration/60)-(4 - (task.duration/60))}+'+ hours'" class="" alt="duration">
                <br>
            </span>
            <!--                                                Displays due date, if available-->
            <span th:if="${task.dueDate != null}" class="text-left" style="display:inline;">
                <img src="/static/images/calendar-check.svg" th:text="' ' + ${#temporals.format(task.dueDate, 'dd MMMM yyyy', new java.util.Locale('en', 'EN'))}" class="" alt="calender">
            </span>
            <!--                                                Displays claimants name if claimed-->
            <span th:if="${task.claimedUserName != null}" class="text-right">
                <span th:if="${task.claimedUserName != currentUser}" class="d-block small opacity-50 text-right" th:text="'Claimed by: '+${task.claimedUserName}">
                </span>
            </span>

        </div>
<!--            <div class="btn-group" role="group" aria-label="Basic example">-->
<!--                <form action="/task/claim">-->
<!--                    <input type="submit" class="btn claim" name="Claim" value="Claim">-->
<!--                </form>-->

<!--                <form action="/task/done">-->
<!--                    <input type="submit" value="Done" class="btn done" >-->
<!--                </form>-->

<!--                <form th:action="@{/task/edit/{taskId}(taskId=${task.taskId})}">-->
<!--                    <input type="submit" class="btn edit" value="Edit">-->
<!--                </form>-->

<!--                <form action="/task/delete">-->
<!--                    <input type="submit" class="btn delete"  value="Delete">-->
<!--                </form>-->
<!--            </div>-->
        </div>
        </div>
    </div>
</div>
<div th:replace="fragments/general :: footer"></div>
<div th:replace="fragments/general :: bottomScripts"></div>
</body>
</html>